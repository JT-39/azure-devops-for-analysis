# DevOps - The Basics

## Background

So far we have only looked at Git in the context of local projects and command line software. This alone doesn't make collaborating on code easy. 

What is needed is a central platform where people can request for changes to be made to the code base and update their code based on changes by others.  

This concept in Git is known as [remotes](https://git-scm.com/book/en/v2/Git-Basics-Working-with-Remotes) or remote repositories.
The following are examples of interactive services that allow you to manage Git projects effectively:

- [GitHub](github.com)
- [Bitbucket](https://bitbucket.org)
- [GitLab](gitlab.com/)
- [Azure DevOps](https://azure.microsoft.com/en-us/services/devops/).

We are using **Azure DevOps** as this is the Department's tool of choice for internal version control. We would use platforms such as GitHub for our more publicly facing projects (such as this book).

To work with internal DevOps Repos you will need an account with Basic access level.
You will also need someone to give you permission to see the DevOps project that you're working on.
There is a form to sort out DevOps account leevls and access on the IT service portal - search for DevOps.

## Theory 

At a high level when you are using DevOps (or any type of remote) you are creating a central copy of your code on a server (the DevOps site). 

The aim of any project is to get your final complete code on to the main branch of the server copy. Analysts will still make and run all their changes locally but will then use the concepts of *pushing*, *pulling* and *pull requesting* to get the DevOps version up to date.

Having this central repository and the approval processes that DevOps provides means that multiple analysts can work on a project at the same time and systematically merge all their changes into the final version after code review.

The following diagram illustrates the concept of server and local copies. 

![](www/distributed_version_control.png)

## Creating a DevOps repository for a new project

To set up a repository on DevOps you need to:

1. Open the DevOps website.
2. Navigate to repositories.
3. Find the current repository name at the top of page and click on it to bring up a dropdown menu.
4. Click "add respository" and give it a suitable name.

This will create you a Git repo on DevOps. By default it will give you a main branch and a README file.

### Clone to your computer

Cloning a repository means that you:

1. Get a copy of it on your computer.
2. Your computer stores where to find the online copy so it can talk to the online one when you ask it to.

To clone the blank repository to your computer you need to get the repo's URL.
It is easiest to do this by:

1. Going to "Files" in the "Repos" section of DevOps.
2. Ensuring you are in the right repository by checking the name in the banner at the top of the screen.
3. Clicking the clone button in the top right-hand corner.
4. Copying the URL.

Once you have copied the URL, you need to open git bash on your computer and clone the repository using the URLS.
When you open git bash you should do so in the folder where you want the repo to be.
Ideally this will be on your C drive, outside of OneDrive of Teams because git repositories don't work well if OneDrive
or Teams are syncing them.
THere is no need for the additional syncing from OneDrive or Teams because DevOps provides the online back-up that others can access.

One you've got git bash open, the clone command will look as follows:

```sh
git clone git_repo_url
```

## Creating a git repository for a project you've been doing on your computer

If you have already been working on a project locally you may wish to push this up and use this as the starting point for the collaborative workflow.

In this case, create a new repository on DevOps but before you click the "Create" button after giving you repository a name, untick the "Add a README" box. This will give a truly blank repository.

Once you click "Create" you will be take to a scree which sayd your new repository is empty.
There will be an option to *Push an exsting repository from command line*.

In order to Push an existing repository you need to do the following:

1. Open Git Bash in your local Git repo
2. Copy the code from the DevOps section and run it

This will set up the connection to DevOps and push an entire copy of the repo up to DevOps.

## Adding users to a project

DevOps is a locked down code environment where users need to first be given permission to access the site as a whole and then individual projects. 

To add users to a project:

1. In the Overview section, go to the summary page 
2. Click on the invite button in the top, right hand corner
2. Search for user
3. Click Add

The user will then get a welcome email inviting them to the project.

## Branch Policies

At this point you will have a project that anyone who is a member of has the ability to push directly to the main/master branch. 

This resource is promoting a workflow in which code is reviewed throughout the development life cycle. Pushing to main/master doesn't allow this directly. 

Instead what we do is set **Branch Policies** which force code to be reviewed in DevOps before it can be merged into master. 

This comes with various options which are summarised below:

1. **Requiring a minimum number of reviewers** - how many people need to approve the code before it can be merged.
2. **Checking for linked work items** - Does the pull request need to have a work item linked
3. **Checking for comment resolution** - Do all of the comments on the pull request need to be resolved before merging is approved
4. **Merge Strategy** - Do you want to enforce a merge strategy. 
5. **Build testing** - not currently explored.

It is recommended that you **enforce all of the first 3 options** and **set the Merge Strategy to Squash**. 

A **squash merge stategy** squashes all commits you made in a branch on your pull request into one for the whole pull request when merged. This ensures a clean working history rather than lots of minor changes.


## Pull Requests

A pull request is a particularly useful bit of DevOps functionality.

A pull request in effect provides a wrapper for the ```git merge``` command outlined in Chapter 2. The visual interface allows you to do the following:

1. Give background to the changes made and link any work items
2. Allow you to assign a colleague to conduct a code review on the changes made
3. Provide a platform for you to discuss the changes and resolve any requests for changes
4. Presents the differences between the two branches in a visual manner (added/removed) so that you can easily see exactly what has been changed.


